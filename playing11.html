<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Playing 11</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#f2f4f8;padding:20px}
.box{background:#fff;padding:16px;border-radius:12px;max-width:420px;margin:auto}
select,button{width:100%;padding:12px;margin:8px 0;font-size:16px}
.player{display:grid;grid-template-columns:2fr 1fr 1fr 1fr;font-size:14px;padding:8px 0;border-bottom:1px solid #eee;align-items:center}
.head{display:grid;grid-template-columns:2fr 1fr 1fr 1fr;font-size:12px;color:#666;font-weight:bold}
button{background:#0a7cff;color:#fff;border:none;border-radius:8px}
</style>
</head>
<body>

<div class="box">
<h2>Select Playing 11</h2>

<select id="teamSelect" onchange="loadPlayers()"></select>

<div class="head">
<div>NAME</div><div>PLAY</div><div>C</div><div>WK</div>
</div>

<div id="players"></div>

<button onclick="save()">SAVE PLAYING11</button>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbwoc84x0cmXWJ6GHzEae4kTJCMdEyvlK7NKq7m12oE6getykgU0UuUUpc37LZcoCuI/exec";
const MATCH_ID="MATCH_1768624533546";

function loadTeams(){
fetch(`${API}?action=getTeams`)
.then(r=>r.json())
.then(d=>{
let h=`<option value="">-- Select Team --</option>`;
d.teams.forEach(t=>h+=`<option value="${t.teamId}">${t.teamName}</option>`);
teamSelect.innerHTML=h;
});
}

function loadPlayers(){
const teamId=teamSelect.value;
players.innerHTML="";
fetch(`${API}?action=getPlayers&teamId=${teamId}`)
.then(r=>r.json())
.then(d=>{
d.players.forEach(p=>{
players.innerHTML+=`
<div class="player">
<div>${p.playerName}</div>
<div><input type="checkbox" class="play" value="${p.playerId}" data-name="${p.playerName}"></div>
<div><input type="radio" name="cap" value="${p.playerId}"></div>
<div><input type="radio" name="wk" value="${p.playerId}"></div>
</div>`;
});
});
}

function save(){
    const teamId = teamSelect.value;
    const play = [...document.querySelectorAll(".play:checked")];
    if(play.length !== 11) return alert("Select exactly 11 players");

    const cap = document.querySelector("input[name=cap]:checked")?.value;
    const wk = document.querySelector("input[name=wk]:checked")?.value;

    const data = play.map(p => ({
        playerId: p.value,
        playerName: p.dataset.name,
        isCaptain: p.value === cap,
        isKeeper: p.value === wk
    }));

    // POST మెథడ్ ఉపయోగిస్తున్నాం - దీనివల్ల ఆర్డర్ మారదు
    fetch(API, {
        method: "POST",
        mode: "no-cors", // క్రాస్ ఆరిజిన్ ఇష్యూ రాకుండా
        cache: "no-cache",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            action: "savePlaying11",
            matchId: MATCH_ID,
            teamId: teamId,
            players: data
        })
    })
    .then(() => alert("Saved Successfully ✅ (Wait a few seconds for sheet to update)"));
}


fetch(`${API}?action=savePlaying11&matchId=${MATCH_ID}&teamId=${teamId}&players=${encodeURIComponent(JSON.stringify(data))}`)
.then(r=>r.json())
.then(d=>alert("Saved ✅"));
}

loadTeams();
</script>
</body>
</html>
