<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Playing 11</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#f2f4f8;padding:20px}
.box{background:#fff;padding:16px;border-radius:12px;max-width:420px;margin:auto}
select,button{width:100%;padding:12px;margin:8px 0;font-size:16px}
.player{display:flex;align-items:center;gap:6px;font-size:14px;padding:6px 0;border-bottom:1px solid #eee}
button{background:#0a7cff;color:#fff;border:none;border-radius:8px}
.subBtn{background:#ff9800}
h3{margin-top:10px}
</style>
</head>
<body>

<div class="box">
<h2>Select Playing 11</h2>

<select id="teamSelect" onchange="loadPlayers()"></select>

<h3 id="modeTitle">Playing 11</h3>
<div id="players"></div>

<button id="saveBtn" onclick="savePlaying11()">SAVE PLAYING11</button>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbwoc84x0cmXWJ6GHzEae4kTJCMdEyvlK7NKq7m12oE6getykgU0UuUUpc37LZcoCuI/exec";
const MATCH_ID="MATCH_1768624533546";

let mode="PLAYING"; // PLAYING / SUBSTITUTE

function loadTeams(){
fetch(`${API}?action=getTeams`)
.then(r=>r.json())
.then(d=>{
let html=`<option value="">-- Select Team --</option>`;
d.teams.forEach(t=>{
html+=`<option value="${t.teamId}">${t.teamName}</option>`;
});
teamSelect.innerHTML=html;
});
}

function loadPlayers(){
const teamId=teamSelect.value;
if(!teamId)return;

fetch(`${API}?action=getPlayers&teamId=${teamId}`)
.then(r=>r.json())
.then(d=>{
players.innerHTML="";
d.players.forEach(p=>{
players.innerHTML+=`
<div class="player">
<input type="checkbox" class="p" value="${p.playerId}">
<span>${p.playerName}</span>
</div>`;
});
});
}

function savePlaying11(){
const teamId=teamSelect.value;
const selected=[...document.querySelectorAll(".p:checked")];

if(mode==="PLAYING"){
if(selected.length!==11)return alert("Select exactly 11 players");

const data=selected.map(p=>({
playerId:p.value,
role:"PLAYING",
isCaptain:false,
isKeeper:false,
isPlaying:true,
isSubstitute:false
}));

fetch(`${API}?action=savePlaying11&matchId=${MATCH_ID}&teamId=${teamId}&players=${encodeURIComponent(JSON.stringify(data))}`)
.then(r=>r.json())
.then(d=>{
mode="SUBSTITUTE";
modeTitle.innerText="Select Substitutes (Max 3)";
saveBtn.innerText="SAVE SUBSTITUTES";
saveBtn.className="subBtn";
document.querySelectorAll(".p").forEach(c=>c.checked=false);
});
}

else{
if(selected.length>3)return alert("Max 3 substitutes only");

const data=selected.map(p=>({
playerId:p.value,
role:"SUBSTITUTE",
isCaptain:false,
isKeeper:false,
isPlaying:false,
isSubstitute:true
}));

fetch(`${API}?action=savePlaying11&matchId=${MATCH_ID}&teamId=${teamId}&players=${encodeURIComponent(JSON.stringify(data))}`)
.then(r=>r.json())
.then(d=>{
alert("Substitutes Saved âœ… Squad Complete");
location.reload();
});
}
}

loadTeams();
</script>
</body>
</html>
