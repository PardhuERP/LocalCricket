<!DOCTYPE html>
<html lang="te">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Cricket Scorer</title>
    <style>
        /* UI ‡∞®‡∞ø ‡∞Ö‡∞Ç‡∞¶‡∞Ç‡∞ó‡∞æ ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø CSS */
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #eef2f3; text-align: center; }
        .header { background: #007bff; color: white; padding: 15px; font-size: 20px; font-weight: bold; }
        .screen { display: none; padding: 20px; animation: fadeIn 0.5s; }
        .active { display: block; }
        input, select { width: 80%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; }
        button { width: 85%; padding: 12px; margin: 10px 0; border: none; border-radius: 5px; background: #28a745; color: white; font-size: 16px; cursor: pointer; }
        
        /* Scoreboard Style */
        #scoreboard { background: #333; color: gold; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .btn-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 10px; }
        .run-btn { background: #fff; color: #333; font-weight: bold; border: 1px solid #ddd; }
        .wicket-btn { background: #dc3545; }
        .extra-btn { background: #ffc107; color: black; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="header">üèè Local Cricket Live</div>

    <div id="setup-screen" class="screen active">
        <h3>Match Details</h3>
        <input type="text" id="teamA" placeholder="Team A Name (Batting)">
        <input type="text" id="teamB" placeholder="Team B Name (Bowling)">
        <input type="number" id="maxOvers" placeholder="Total Overs">
        <button onclick="loadPlayers()">Next: Select Players</button>
    </div>

    <div id="player-setup-screen" class="screen">
        <h3>Select Initial Players</h3>
        <p>Batting: <b id="battingTeamName"></b></p>
        <label>Striker:</label>
        <select id="select-striker"></select>
        <label>Non-Striker:</label>
        <select id="select-non-striker"></select>
        <p>Bowling: <b id="bowlingTeamName"></b></p>
        <label>Opening Bowler:</label>
        <select id="select-bowler"></select>
        <button onclick="confirmMatchStart()">Start Scoring</button>
    </div>

    <div id="scoring-screen" class="screen">
        <div id="scoreboard">
            <h2 id="live-score">0 - 0</h2>
            <p id="live-overs">Overs: 0.0</p>
            <hr>
            <div style="display: flex; justify-content: space-around; font-size: 14px;">
                <div id="disp-striker" style="color: lightgreen;">* Striker</div>
                <div id="disp-nonstriker">Non-Striker</div>
            </div>
            <p id="disp-bowler" style="font-size: 13px; color: #aaa;">Bowler: --</p>
        </div>

        <div class="btn-grid">
            <button class="run-btn" onclick="addRuns(0)">0</button>
            <button class="run-btn" onclick="addRuns(1)">1</button>
            <button class="run-btn" onclick="addRuns(2)">2</button>
            <button class="run-btn" onclick="addRuns(3)">3</button>
            <button class="run-btn" onclick="addRuns(4)">4</button>
            <button class="run-btn" onclick="addRuns(6)">6</button>
            <button class="extra-btn" onclick="handleExtra('WD')">WD</button>
            <button class="extra-btn" onclick="handleExtra('NB')">NB</button>
            <button class="wicket-btn" onclick="handleWicket()">WICKET</button>
        </div>
        <button onclick="undoBall()" style="background: #6c757d;">Undo Ball</button>
    </div>

    <script>
        // 1. ‡∞∏‡±Ü‡∞ü‡∞™‡±ç ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞µ‡±á‡∞∞‡∞ø‡∞Ø‡∞¨‡±Å‡∞≤‡±ç‡∞∏‡±ç
        let api_url = "https://script.google.com/macros/s/AKfycbyS7TFThInUkfaB1znFuf6zmST779Qzjo6oJkGLOoNcllxT1CYI4Wbe4HVw3LLnz9hL1A/exec"; 
        let runs = 0, wickets = 0, balls = 0, currentOverBalls = 0;
        let playersData = [];

        // 2. ‡∞™‡±ç‡∞≤‡±á‡∞Ø‡∞∞‡±ç‡∞∏‡±ç ‡∞®‡∞ø ‡∞∑‡±Ä‡∞ü‡±ç ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞°‡∞Ç
        async function loadPlayers() {
            const tA = document.getElementById('teamA').value;
            const tB = document.getElementById('teamB').value;

            if(!tA || !tB) { alert("Please enter team names"); return; }

            document.getElementById('battingTeamName').innerText = tA;
            document.getElementById('bowlingTeamName').innerText = tB;

            // Loading message
            alert("Loading players from Google Sheets...");
            
            try {
                let resp = await fetch(api_url + "?action=read&sheet=Players");
                playersData = await resp.json();
                
                fillDropdown('select-striker', tA);
                fillDropdown('select-non-striker', tA);
                fillDropdown('select-bowler', tB);

                showScreen('player-setup-screen');
            } catch (e) {
                alert("Error loading players. Make sure your API is working!");
            }
        }

        function fillDropdown(elementId, teamName) {
            let dropdown = document.getElementById(elementId);
            dropdown.innerHTML = "";
            let filtered = playersData.filter(p => p.TeamName == teamName);
            filtered.forEach(p => {
                let opt = document.createElement('option');
                opt.value = p.PlayerName;
                opt.text = p.PlayerName;
                dropdown.appendChild(opt);
            });
        }

        function confirmMatchStart() {
            document.getElementById('disp-striker').innerText = "* " + document.getElementById('select-striker').value;
            document.getElementById('disp-nonstriker').innerText = document.getElementById('select-non-striker').value;
            document.getElementById('disp-bowler').innerText = "Bowler: " + document.getElementById('select-bowler').value;
            showScreen('scoring-screen');
        }

        // 3. ‡∞∏‡±ç‡∞ï‡±ã‡∞∞‡∞ø‡∞Ç‡∞ó‡±ç ‡∞≤‡∞æ‡∞ú‡∞ø‡∞ï‡±ç
        function addRuns(r) {
            runs += r;
            balls++;
            currentOverBalls++;
            updateDisplay();
            checkOverEnd();
        }

        function handleWicket() {
            wickets++;
            balls++;
            currentOverBalls++;
            updateDisplay();
            if(wickets < 10) {
                alert("Wicket! Select new batsman.");
                // ‡∞á‡∞ï‡±ç‡∞ï‡∞° ‡∞¨‡±ç‡∞Ø‡∞æ‡∞ü‡±ç‡∞∏‡±ç‚Äå‡∞Æ‡∞®‡±ç ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ö‡±á ‡∞≤‡∞æ‡∞ú‡∞ø‡∞ï‡±ç ‡∞µ‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø
            }
            checkOverEnd();
        }

        function updateDisplay() {
            let ov = Math.floor(balls/6) + "." + (balls%6);
            document.getElementById('live-score').innerText = runs + " - " + wickets;
            document.getElementById('live-overs').innerText = "Overs: " + ov;
        }

        function checkOverEnd() {
            if(currentOverBalls == 6) {
                alert("Over End! Change Bowler.");
                currentOverBalls = 0;
                // ‡∞∏‡±ç‡∞ü‡±ç‡∞∞‡±à‡∞ï‡∞∞‡±ç ‡∞Æ‡∞æ‡∞∞‡±ç‡∞™‡∞ø‡∞°‡∞ø ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞¨‡±å‡∞≤‡∞∞‡±ç ‡∞∏‡±Ü‡∞≤‡±Ü‡∞ï‡±ç‡∞∑‡∞®‡±ç ‡∞á‡∞ï‡±ç‡∞ï‡∞° ‡∞µ‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø
            }
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
    </script>
</body>
</html>
