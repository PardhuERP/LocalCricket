<!DOCTYPE html>
<html lang="te">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricket Scorer Pro</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f0f2f5; text-align: center; }
        .header { background: #1a237e; color: white; padding: 20px; font-size: 22px; }
        .screen { display: none; padding: 20px; }
        .active { display: block; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input, select { width: 90%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
        .btn { width: 95%; padding: 12px; margin: 10px 0; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; }
        .btn-primary { background: #1a237e; color: white; }
        .btn-success { background: #2e7d32; color: white; }
        .btn-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .score-box { background: #212121; color: #ffeb3b; padding: 20px; border-radius: 10px; }
    </style>
</head>
<body>

<div class="header">üèè Local Cricket App</div>

<div id="dashboard-screen" class="screen active">
    <div class="card">
        <h3>Main Dashboard</h3>
        <button class="btn btn-primary" onclick="showScreen('team-screen')">‚ûï Create Team / Add Players</button>
        <button class="btn btn-success" onclick="goToMatchSetup()">üèè Start New Match</button>
        <button class="btn" style="background: #fb8c00; color: white;">üìä Match History</button>
    </div>
</div>

<div id="team-screen" class="screen">
    <div class="card">
        <h3>Register Team & Players</h3>
        <input type="text" id="regTeamName" placeholder="Enter Team Name">
        <input type="text" id="regPlayerName" placeholder="Enter Player Name">
        <select id="regPlayerRole">
            <option value="Batsman">Batsman</option>
            <option value="Bowler">Bowler</option>
            <option value="All-Rounder">All-Rounder</option>
        </select>
        <button class="btn btn-success" onclick="savePlayer()">Save Player</button>
        <button class="btn" onclick="showScreen('dashboard-screen')">Back to Dashboard</button>
    </div>
</div>

<div id="setup-screen" class="screen">
    <div class="card">
        <h3>Match Setup</h3>
        <input type="text" id="teamA" placeholder="Batting Team Name">
        <input type="text" id="teamB" placeholder="Bowling Team Name">
        <input type="number" id="maxOvers" placeholder="Total Overs">
        <button class="btn btn-primary" onclick="loadPlayersForMatch()">Select Players & Start</button>
    </div>
</div>

<div id="player-setup-screen" class="screen">
    <div class="card">
        <h3>Select Playing XI</h3>
        <label>Striker:</label> <select id="select-striker"></select>
        <label>Non-Striker:</label> <select id="select-non-striker"></select>
        <label>Opening Bowler:</label> <select id="select-bowler"></select>
        <button class="btn btn-success" onclick="startScoring()">Start Match</button>
    </div>
</div>

<div id="scoring-screen" class="screen">
    <div class="score-box">
        <h1 id="live-score">0 - 0</h1>
        <p id="live-overs">Overs: 0.0</p>
        <div style="display: flex; justify-content: space-around;">
            <span id="disp-striker" style="color: #4caf50;">* Player 1</span>
            <span id="disp-nonstriker">Player 2</span>
        </div>
    </div>
    <div class="btn-grid" style="margin-top: 20px;">
        <button class="btn" onclick="addRuns(0)">0</button>
        <button class="btn" onclick="addRuns(1)">1</button>
        <button class="btn" onclick="addRuns(2)">2</button>
        <button class="btn" onclick="addRuns(3)">3</button>
        <button class="btn" onclick="addRuns(4)" style="background: #ff9800;">4</button>
        <button class="btn" onclick="addRuns(6)" style="background: #ff9800;">6</button>
        <button class="btn" style="background: #f44336; color: white;" onclick="handleWicket()">W</button>
        <button class="btn" style="background: #9e9e9e;">WD</button>
        <button class="btn" style="background: #9e9e9e;">NB</button>
    </div>
</div>

<script>
    let api_url = "https://script.google.com/macros/s/AKfycbyS7TFThInUkfaB1znFuf6zmST779Qzjo6oJkGLOoNcllxT1CYI4Wbe4HVw3LLnz9hL1A/exec"; // ‡∞á‡∞ï‡±ç‡∞ï‡∞° ‡∞Æ‡±Ä URL ‡∞™‡±Ü‡∞ü‡±ç‡∞ü‡∞Ç‡∞°‡∞ø
    let playersData = [];
    let runs = 0, wickets = 0, balls = 0;

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // ‡∞ü‡±Ä‡∞Æ‡±ç ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞™‡±ç‡∞≤‡±á‡∞Ø‡∞∞‡±ç ‡∞®‡∞ø ‡∞∏‡±á‡∞µ‡±ç ‡∞ö‡±á‡∞Ø‡∞°‡∞Ç
    async function savePlayer() {
        let tName = document.getElementById('regTeamName').value;
        let pName = document.getElementById('regPlayerName').value;
        let pRole = document.getElementById('regPlayerRole').value;

        if(!tName || !pName) { alert("Please fill details"); return; }

        let data = {
            action: "insert",
            sheet: "Players",
            values: [new Date().getTime(), tName, pName, pRole]
        };

        let resp = await fetch(api_url, { method: "POST", body: JSON.stringify(data) });
        alert("Player Saved Successfully!");
        document.getElementById('regPlayerName').value = "";
    }

    function goToMatchSetup() { showScreen('setup-screen'); }

    // ‡∞™‡±ç‡∞≤‡±á‡∞Ø‡∞∞‡±ç‡∞∏‡±ç ‡∞®‡∞ø ‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞°‡∞Ç
    async function loadPlayersForMatch() {
        let tA = document.getElementById('teamA').value;
        let tB = document.getElementById('teamB').value;
        
        let resp = await fetch(api_url + "?action=read&sheet=Players");
        playersData = await resp.json();

        fillDropdown('select-striker', tA);
        fillDropdown('select-non-striker', tA);
        fillDropdown('select-bowler', tB);
        showScreen('player-setup-screen');
    }

    function fillDropdown(id, team) {
        let select = document.getElementById(id);
        select.innerHTML = "";
        let filtered = playersData.filter(p => p.TeamName == team);
        filtered.forEach(p => {
            let opt = document.createElement('option');
            opt.value = p.PlayerName;
            opt.text = p.PlayerName;
            select.appendChild(opt);
        });
    }

    function startScoring() {
        document.getElementById('disp-striker').innerText = "* " + document.getElementById('select-striker').value;
        document.getElementById('disp-nonstriker').innerText = document.getElementById('select-non-striker').value;
        showScreen('scoring-screen');
    }

    function addRuns(r) {
        runs += r;
        balls++;
        updateScore();
    }

    function updateScore() {
        let ov = Math.floor(balls/6) + "." + (balls%6);
        document.getElementById('live-score').innerText = runs + " - " + wickets;
        document.getElementById('live-overs').innerText = "Overs: " + ov;
    }

    function handleWicket() {
        wickets++;
        balls++;
        updateScore();
    }
</script>

</body>
</html>
